<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
<title>BAT Controller</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.2.13/dist/semantic.min.css">
</head>
<body style="padding-top: 3rem;">
    <div class="ui text container">
        <h1 class="ui center aligned grey header">B.A.T Controller</h1>
        <div class="ui two column grid">
            <div class="center aligned row">
                <div class="column">
                    <div id="resetButton" class="ui link card" style="width: 100%">
                        <div class="content"><i aria-hidden="true" class="huge undo icon"></i></div>
                        <div class="content">Reset Player Position</div>
                    </div>
                </div>
                <div class="column">
                    <div id="updateButton" class="ui link card" style="width: 100%">
                        <div class="content"><i aria-hidden="true" class="huge level up icon"></i></div>
                        <div class="content">Update BPMN Model</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="ui three column grid">
            <div class="center aligned row">
                <div class="column">
                    <button id="showVRButton" class="big active toggle fluid basic labeled icon ui button">
                        <i class="game icon"></i>
                        VR Content
                    </button>
                </div>
                <div class="column">
                    <button id="showBPMNButton" class="big toggle fluid basic labeled icon ui button">
                        <i class="image icon"></i>
                        Diagram
                    </button>
                </div>
                <div class="column">
                    <button id="showSplashButton" class="big toggle fluid basic labeled icon ui button">
                        <i class="lightning icon"></i>
                        Splash
                    </button>
                </div>
            </div>
        </div>
    </div>
<script type="application/javascript">
  let connected = false;

  var socket = new WebSocket("ws://"+window.location.host);
  socket.onmessage = function(evt) {
    console.log('got data from client', evt.data);
    
    switch(evt.data) {
        case 'CONNECTED': connected = true; break;
        case 'DISCONNECTED': connected = false; break;
    }
  }
  
  socket.onopen = function(evt) {
    socket.send('INIT|CONTROLLER');
  }

  resetButton.addEventListener('click', () => {
    socket.send('RESET');
  });

  updateButton.addEventListener('click', () => {
    const input = document.createElement('input');

      input.setAttribute('type', 'file');
      input.setAttribute('accept', '.bpmn');

      input.addEventListener('change', evt => {
        const file = input.files[0];
        const reader = new FileReader();

        reader.addEventListener('load', e => {
          socket.send('BPMN|' + e.target.result);
        });

        reader.readAsText(file);
      });
      input.click();
  });

  showVRButton.addEventListener('click', () => {
    socket.send('SHOW|VR');
    setActiveBtn(showVRButton);
  });

  showBPMNButton.addEventListener('click', () => {
    socket.send('SHOW|BPMN');
    setActiveBtn(showBPMNButton);
  });
  
  showSplashButton.addEventListener('click', () => {
    socket.send('SHOW|SPLASH');
    setActiveBtn(showSplashButton);
  });

  function setActiveBtn(btn) {
      const btns = document.querySelectorAll('.big.toggle.button');
      for(let i = 0; i < btns.length; i++) {
          btns[i].classList.remove('active');
      }

      btn.classList.add('active');
  }
</script>
</body>
</html>